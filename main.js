(()=>{"use strict";var e={111:(e,t,n)=>{n.r(t)},119:e=>{var t=document.querySelector("#card-template").content;e.exports={deleteCard:function(e){e.remove(),e.onDelete&&e.onDelete()},createCard:function(e){var n=e.name,o=e.imageLink,r=e.deleteCallback,a=e.likeCallback,c=e.imageCallback,i=e.likes,l=e.cardId,u=t.querySelector(".card").cloneNode(!0),s=u.querySelector(".card__image"),d=u.querySelector(".card__title"),p=u.querySelector(".card__likes-counter");u.dataset.cardId=l,i&&(p.textContent=i.length),d.textContent=n,s.src=o,s.alt=n;var f=u.querySelector(".card__delete-button");r?f.addEventListener("click",(function(){return r(u)})):f.style.display="none";var _=u.querySelector(".card__like-button");return _.addEventListener("click",(function(){return a(_)})),s.addEventListener("click",(function(){return c(n,o)})),u},likeCard:function(e){e.classList.toggle("card__like-button_is-active")}}},228:e=>{var t={baseUrl:"https://nomoreparties.co/v1/".concat("wff-cohort-39"),headers:{authorization:"9d29cde5-0e1d-4122-9a30-6c4600aaebc9","Content-Type":"application/json"}};e.exports={getProfile:function(){return fetch("".concat(t.baseUrl,"/users/me"),{headers:t.headers}).then((function(e){return e.ok?e.json():Promise.reject("ERROR: ".concat(e.status))})).catch((function(e){console.log(e)}))},getInitialCards:function(){return fetch("".concat(t.baseUrl,"/cards"),{headers:t.headers}).then((function(e){return e.ok?e.json():Promise.reject("ERROR: ".concat(e.status))})).catch((function(e){console.log(e)}))},patchProfile:function(e,n){return fetch("".concat(t.baseUrl,"/users/me"),{method:"PATCH",headers:t.headers,body:JSON.stringify({name:e,about:n})}).then((function(e){return e.ok?e.json():Promise.reject("ERROR: ".concat(e.status))})).catch((function(e){console.log(e)}))},postCard:function(e,n){return fetch("".concat(t.baseUrl,"/cards"),{method:"POST",headers:t.headers,body:JSON.stringify({name:e,link:n})}).then((function(e){return e.ok?e.json():Promise.reject("post card error: ".concat(e.status))})).catch((function(e){console.log(e)}))},deleteCardFetch:function(e){var n=e.dataset.cardId;return fetch("".concat(t.baseUrl,"/cards/").concat(n),{method:"DELETE",headers:t.headers}).catch((function(e){console.log(e)}))},likeCardFetch:function(e){return fetch("".concat(t.baseUrl,"/cards/likes/").concat(e),{method:"PUT",headers:t.headers}).catch((function(e){console.log(e)}))},unlikeCardFetch:function(e){return fetch("".concat(t.baseUrl,"/cards/likes/").concat(e),{method:"DELETE",headers:t.headers}).catch((function(e){console.log(e)}))},patchProfileImage:function(e){return(n=e,fetch(n,{method:"HEAD"}).then((function(e){return e.ok&&"image"===e.headers.get("Content-Type").split("/")[0]?e:Promise.reject("Entered invalid url")}))).then((function(){return fetch("".concat(t.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:t.headers,body:JSON.stringify({avatar:e})}).catch((function(e){console.log("Change profile Image error: ".concat(e))}))}));var n}}},520:e=>{function t(e){e.classList.remove("popup_is-opened"),document.removeEventListener("keydown",n)}function n(e){"Escape"===e.key&&t(document.querySelector(".popup_is-opened"))}e.exports={openModal:function(e){e.classList.add("popup_is-opened"),document.addEventListener("keydown",n)},closeModal:t,closeModalOnEsc:n,closeModalOnOverlay:function(e){e.target===e.currentTarget&&t(e.currentTarget)}}},725:e=>{function t(e,t,a,c){e.validity.valid?(n(e,a),r(t,c)):(function(e,t){e.classList.add(t)}(e,a),e.validity.patternMismatch?o(t,c,e,e.dataset.errorMessage):o(t,c,e))}function n(e,t){e.classList.remove(t)}function o(e,t,n){var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:n.validationMessage;e.classList.add(t),e.textContent=o}function r(e,t){e.classList.remove(t),e.textContent=""}function a(e,t){e.classList.add(t),e.disabled=!0}function c(e,t){e.classList.remove(t),e.disabled=!1}function i(e,t){return Array.from(e.querySelectorAll(t)).reduce((function(e,t){return!(!e||!t.validity.valid)}),!0)}function l(e){var t=e.form,n=e.submitButton,o=e.inactiveButtonClass;i(t,e.inputSelector)?c(n,o):a(n,o)}e.exports={showError:o,hideError:r,validateInput:t,disableButton:a,activateButton:c,checkFormValidity:i,toggleButtonState:l,enableValidation:function(e){var n=e.formSelector,o=e.inputSelector,r=e.submitButtonSelector,c=e.inactiveButtonClass,i=e.inputErrorClass,u=e.errorClass,s=e.errorClassVisible;Array.from(document.querySelectorAll(n)).forEach((function(e){var n=e.querySelector(r);a(n,c),Array.from(e.querySelectorAll(o)).forEach((function(r){var a=r.closest(".popup__field").querySelector(".".concat(u));r.addEventListener("input",(function(){t(r,a,i,s),l({form:e,submitButton:n,inactiveButtonClass:c,inputSelector:o})}))}))}))},clearValidation:function(e,t){var o=t.inputSelector,c=t.submitButtonSelector,i=t.inactiveButtonClass,l=t.inputErrorClass,u=t.errorClassVisible;Array.from(e.querySelectorAll(o)).forEach((function(e){return n(e,l)})),Array.from(e.querySelectorAll(".".concat(u))).forEach((function(e){return r(e,u)})),a(e.querySelector(c),i)}}}},t={};function n(o){var r=t[o];if(void 0!==r)return r.exports;var a=t[o]={exports:{}};return e[o](a,a.exports,n),a.exports}n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var o=n(119),r=n(520),a=n(725),c=n(228);function i(e,t){O.textContent=e,A.src=t,A.alt=e,(0,r.openModal)(j)}function l(e){(0,c.deleteCardFetch)(e).then((0,o.deleteCard)(e))}function u(e){e.classList.contains("card__like-button_is-active")?function(e){var t=e.closest(".card"),n=t.dataset.cardId;(0,c.unlikeCardFetch)(n).then((function(e){if(e.ok)return e.json()})).then((function(e){t.querySelector(".card__likes-counter").textContent=e.likes.length}))}(e):function(e){var t=e.closest(".card"),n=t.dataset.cardId;(0,c.likeCardFetch)(n).then((function(e){if(e.ok)return e.json()})).then((function(e){t.querySelector(".card__likes-counter").textContent=e.likes.length}))}(e),(0,o.likeCard)(e)}n(111);var s={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_has-error",errorClass:"popup__error",errorClassVisible:"popup__error_visible"},d=document.querySelector(".popup_type_edit .popup__form"),p=document.querySelector(".popup_type_new-card .popup__form"),f=document.querySelector(".popup_type_edit-image .popup__form"),_=document.querySelector(".places__list"),m=null,y=(0,c.getProfile)();y.then((function(e){m=e._id})),Promise.all([y]).then((function(){return(0,c.getInitialCards)()})).then((function(e){e.forEach((function(e){var t=e.name,n=e.link,r=e.owner._id,a=(0,o.createCard)({name:t,imageLink:n,deleteCallback:r===m&&l,likeCallback:u,imageCallback:i,likes:e.likes,cardId:e._id});if(e.likes.some((function(e){return e._id===m}))){var c=a.querySelector(".card__like-button");(0,o.likeCard)(c)}_.append(a)}))}));var h=document.querySelector(".popup__input_type_card-name"),v=document.querySelector(".popup__input_type_url"),C=document.querySelector(".popup_type_edit"),S=document.querySelector(".profile__edit-button"),k=C.querySelector(".popup__input_type_name"),b=C.querySelector(".popup__input_type_description"),g=C.querySelector(".popup__button"),q=document.querySelector(".profile__title"),E=document.querySelector(".profile__description"),L=document.querySelector(".profile__image");y.then((function(e){q.textContent=e.name,E.textContent=e.about,L.style["background-image"]="url(".concat(e.avatar,")")})),S.addEventListener("click",(function(){k.value=q.textContent,b.value=E.textContent,(0,a.clearValidation)(d,s),(0,r.openModal)(C)}));var x=document.querySelector(".popup_type_new-card"),P=document.querySelector(".profile__add-button"),M=x.querySelector(".popup__button");P.addEventListener("click",(function(){(0,r.openModal)(x)}));var j=document.querySelector(".popup_type_image"),A=j.querySelector(".popup__image"),O=j.querySelector(".popup__caption"),B=document.querySelector(".popup_type_edit-image"),I=B.querySelector(".popup__input_type_image"),T=B.querySelector(".popup__button");L.addEventListener("click",(function(){(0,r.openModal)(B)})),document.querySelectorAll(".popup").forEach((function(e){var t=e.querySelector(".popup__close");e.addEventListener("click",r.closeModalOnOverlay),t.addEventListener("click",(function(){(0,r.closeModal)(e)})),e.classList.add("popup_is-animated")})),d.addEventListener("submit",(function(e){e.preventDefault();var t=k.value,n=b.value;g.textContent="Сохранение...",(0,c.patchProfile)(t,n).then((function(e){q.textContent=e.name,E.textContent=e.about,(0,r.closeModal)(C)})).finally((function(){g.textContent="Сохранить"}))})),p.addEventListener("submit",(function(e){e.preventDefault();var t=h.value,n=v.value;M.textContent="Сохранение...",(0,c.postCard)(t,n).then((function(t){if(t){var n=(0,o.createCard)({name:t.name,imageLink:t.link,deleteCallback:l,likeCallback:u,imageCallback:i,likes:t.likes,cardId:t._id});_.prepend(n),e.target.reset(),(0,a.clearValidation)(e.target,s),(0,r.closeModal)(x)}})).finally((function(){M.textContent="Сохранить"}))})),f.addEventListener("submit",(function(e){e.preventDefault(),T.textContent="Сохранение...";var t=I.value;(0,c.patchProfileImage)(t).then((function(){return(0,c.getProfile)()})).then((function(e){L.style["background-image"]="url(".concat(e.avatar,")"),(0,r.closeModal)(B)})).finally((function(){T.textContent="Сохранить"}))})),(0,a.enableValidation)(s)})();